import{i as t}from"./p-45352c6b.js";import{W as n}from"./p-23766e60.js";var e=function(){if("undefined"!=typeof Map)return Map;function t(t,n){var e=-1;return t.some((function(t,i){return t[0]===n&&(e=i,!0)})),e}return function(){function n(){this.__entries__=[]}return Object.defineProperty(n.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),n.prototype.get=function(n){var e=t(this.__entries__,n),i=this.__entries__[e];return i&&i[1]},n.prototype.set=function(n,e){var i=t(this.__entries__,n);~i?this.__entries__[i][1]=e:this.__entries__.push([n,e])},n.prototype.delete=function(n){var e=this.__entries__,i=t(e,n);~i&&e.splice(i,1)},n.prototype.has=function(n){return!!~t(this.__entries__,n)},n.prototype.clear=function(){this.__entries__.splice(0)},n.prototype.forEach=function(t,n){void 0===n&&(n=null);for(var e=0,i=this.__entries__;e<i.length;e++){var r=i[e];t.call(n,r[1],r[0])}},n}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),o="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)},s=["top","right","bottom","left","width","height","size","weight"],h="undefined"!=typeof MutationObserver,a=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t){var n=!1,e=!1,i=0;function r(){n&&(n=!1,t()),e&&h()}function s(){o(r)}function h(){var t=Date.now();if(n){if(t-i<2)return;e=!0}else n=!0,e=!1,setTimeout(s,20);i=t}return h}(this.refresh.bind(this))}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var n=this.observers_,e=n.indexOf(t);~e&&n.splice(e,1),!n.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),h?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var n=t.propertyName,e=void 0===n?"":n;s.some((function(t){return!!~e.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),u=function(t,n){for(var e=0,i=Object.keys(n);e<i.length;e++){var r=i[e];Object.defineProperty(t,r,{value:n[r],enumerable:!1,writable:!1,configurable:!0})}return t},c=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||r},f=m(0,0,0,0);function d(t){return parseFloat(t)||0}function l(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return n.reduce((function(n,e){return n+d(t["border-"+e+"-width"])}),0)}var w="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof c(t).SVGGraphicsElement}:function(t){return t instanceof c(t).SVGElement&&"function"==typeof t.getBBox};function p(t){return i?w(t)?function(t){var n=t.getBBox();return m(0,0,n.width,n.height)}(t):function(t){var n=t.clientWidth,e=t.clientHeight;if(!n&&!e)return f;var i=c(t).getComputedStyle(t),r=function(t){for(var n={},e=0,i=["top","right","bottom","left"];e<i.length;e++){var r=i[e];n[r]=d(t["padding-"+r])}return n}(i),o=r.left+r.right,s=r.top+r.bottom,h=d(i.width),a=d(i.height);if("border-box"===i.boxSizing&&(Math.round(h+o)!==n&&(h-=l(i,"left","right")+o),Math.round(a+s)!==e&&(a-=l(i,"top","bottom")+s)),!function(t){return t===c(t).document.documentElement}(t)){var u=Math.round(h+o)-n,w=Math.round(a+s)-e;1!==Math.abs(u)&&(h-=u),1!==Math.abs(w)&&(a-=w)}return m(r.left,r.top,h,a)}(t):f}function m(t,n,e,i){return{x:t,y:n,width:e,height:i}}var v=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=m(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=p(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),b=function(t,n){var e,i,r,o,s,h,a,c=(i=(e=n).x,r=e.y,o=e.width,s=e.height,h="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,a=Object.create(h.prototype),u(a,{x:i,y:r,width:o,height:s,top:r,right:i+o,bottom:s+r,left:i}),a);u(this,{target:t,contentRect:c})},g=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof c(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)||(n.set(t,new v(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof c(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)&&(n.delete(t),n.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(n){n.isActive()&&t.activeObservations_.push(n)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,n=this.activeObservations_.map((function(t){return new b(t.target,t.broadcastRect())}));this.callback_.call(t,n,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),y="undefined"!=typeof WeakMap?new WeakMap:new e,M=function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=a.getInstance(),i=new g(n,e,this);y.set(this,i)};["observe","unobserve","disconnect"].forEach((function(t){M.prototype[t]=function(){var n;return(n=y.get(this))[t].apply(n,arguments)}}));var E=void 0!==r.ResizeObserver?r.ResizeObserver:M;const O=t=>{const n=t.getBoundingClientRect();return{width:n.width,height:n.height,left:n.left+window.scrollX,right:n.right+window.scrollX,bottom:n.bottom+window.scrollY,top:n.top+window.scrollY,x:n.x+window.scrollX,y:n.y+window.scrollY,density:window.devicePixelRatio}};class D{constructor(t){this.rectMap={},this.canvas=t,this.updateCanvas()}updateCanvas(){this.canvasRect=this.canvas.getBoundingClientRect()}updateChartScene(t,n){this.rectMap[t]=n}clipRect(t){return this.rectMap[t]?((t,n)=>{const e=window.devicePixelRatio,{left:i,bottom:r,width:o,height:s}=t,h=n.bottom-(r-window.scrollY);return{left:(i-n.left-window.scrollX)*e,bottom:h*e,width:o*e,height:s*e}})(this.rectMap[t],this.canvasRect):void 0}removeChartScene(t){delete this.rectMap[t]}}const S=t(t=>null!=t.camera),z=(t=>{let e,i,r,o,s;const h=()=>{i&&(i.setScissorTest(!1),i.setClearColor(16777215,0),i.clear(),i.setScissorTest(!0),t.managers().filter(S).forEach(f))},a=()=>{if(i&&r){let t=0,n=0;if(!o)return;"scrollX"in o?(t=o.scrollX,n=o.scrollY):(t=o.scrollLeft,n=o.scrollTop),i.domElement.style.transform=`translate(${t}px, ${n}px)`,e.updateCanvas(),h()}},u=()=>{c(),i&&r&&(function(t){const n=t.domElement,e=Math.floor(n.clientWidth*window.devicePixelRatio)||0,i=Math.floor(n.clientHeight*window.devicePixelRatio)||0;(n.width!==e||n.height!==i)&&t.setSize(e,i,!1)}(i),e.updateCanvas(),h())},c=()=>{if(null==e)throw new Error("webgl context must be initialized before it can be utilized. Please refer to https://synchrocharts.com/#/Setup to learn more about how to setup Synchro Charts.")},f=t=>{c();const n=e.clipRect(t.id);i&&r&&n&&((t,{scene:n,camera:e},{left:i,bottom:r,width:o,height:s})=>{t.setScissor(i,r,o,s),t.setViewport(i,r,o,s),t.render(n,e)})(i,t,n)};return{initRendering:(t,h=(()=>{}),c)=>{e=new D(t),r=t,i=new n({canvas:r,alpha:!0,antialias:!0,preserveDrawingBuffer:!0}),o=c||window,h(i.getContext()),i.setScissorTest(!0),i.setClearColor(0,0),a(),u(),o.addEventListener("scroll",a),o instanceof Element?(s=new E(u),s.observe(o)):o.addEventListener("resize",u)},dispose:()=>{i&&i.dispose(),t.dispose(),o&&(o.removeEventListener("scroll",a),o.removeEventListener("resize",u)),s&&s.disconnect()},render:f,addChartScene:({manager:n,chartSize:e,duration:i,shouldSync:r=!0})=>t.add({manager:n,chartSize:e,duration:i,shouldSync:r}),removeChartScene:n=>{c(),t.remove(n),e.removeChartScene(n),h()},setChartRect:(t,n)=>{c(),e.updateChartScene(t,n),h()},updateViewPorts:t.syncViewPortGroup,startTick:t.startTick,stopTick:t.stopTick,onResolutionChange:()=>{u()}}})(new class{constructor(){this.viewportManagers=[],this.viewportMap={},this.viewportLiveId={},this.managers=()=>[...this.viewportManagers],this.dispose=()=>{this.viewportManagers.forEach(({id:t})=>this.remove(t))},this.startTick=({manager:t,duration:n,chartSize:e})=>{if(null==e)return;const i=new Date((new Date).getTime()-n),r=new Date,o=null!=t.viewportGroup?t.viewportGroup:t.id,s=t.id,h=1/e.width*n;s in this.viewportLiveId||(this.viewportLiveId[s]={viewportGroup:t.viewportGroup},this.viewportLiveId[s].intervalId=setInterval(()=>{const e=new Date(Date.now()-n),i=new Date;this.viewportMap[o]={start:e,end:i};const r=Boolean(n);t.updateViewPort({start:e,end:i,duration:n,shouldBlockDateRangeChangedEvent:r})},h),this.viewportMap[o]={start:i,end:r},this.syncViewPortGroup({start:i,end:r,manager:t,duration:n}))},this.stopTick=({manager:t,viewportGroup:n})=>{if(null==t&&null==n)return;const e=t=>{null!=this.viewportLiveId[t]&&(clearInterval(this.viewportLiveId[t].intervalId),delete this.viewportLiveId[t])};null!=n?Object.entries(this.viewportLiveId).filter(([,t])=>t.viewportGroup===n).forEach(([t])=>e(t)):null!=t&&e(t.id)},this.add=({manager:t,chartSize:n,duration:e,shouldSync:i=!0})=>{if(this.viewportManagers=[...this.viewportManagers,t],t.viewportGroup&&this.viewportMap[t.viewportGroup]&&i){const n=Boolean(e);t.updateViewPort(Object.assign(Object.assign({},this.viewportMap[t.viewportGroup]),{duration:e,shouldBlockDateRangeChangedEvent:n}))}null!=e&&this.startTick({manager:t,duration:e,chartSize:n})},this.remove=t=>{const n=this.viewportManagers.find(({id:n})=>n===t);n&&n.dispose&&(this.stopTick({manager:n}),n.dispose()),this.viewportManagers=this.viewportManagers.filter(({id:n})=>n!==t)},this.syncViewPortGroup=({start:t,end:n,manager:e,duration:i})=>{this.viewportMap[e.viewportGroup?e.viewportGroup:e.id]={start:t,end:n},null==i&&this.stopTick({manager:e,viewportGroup:e.viewportGroup});const r=e=>{const r=Boolean(i);e.updateViewPort({start:t,end:n,duration:i,shouldBlockDateRangeChangedEvent:r})};e.viewportGroup?this.viewportManagers.filter(({viewportGroup:t})=>e.viewportGroup===t).forEach(r):r(e)}}});export{E as i,O as r,z as w}